## AI機能 実用稼働化ロードマップ（PR統合 5件）
- （AIへ注意事項：対応が完了したら、終わった項目はチェックボックスをONにしてください。）

### PR1. バックエンド：LLM/RAG プロバイダ実装と設定実運用化
- 現状の課題: `get_llm_provider()` がプレースホルダ、RAG/Chroma は最小フォールバックで本番設定/監視が未整備
- [x] `get_llm_provider` を実装（openai/azure-openai/local を切替、タイムアウト/リトライ/バックオフ）
- [x] LLMモデル設定の導入：`Settings.llm_model` を追加（env: `LLM_MODEL`、既定: `gpt-5-mini`）
- [x] `.env.example` に `LLM_MODEL=gpt-5-mini` を追記、README に説明を追加
- [x] `get_llm_provider` 内で `settings.llm_model` を用いてモデル指定を行う
- [x] 埋め込みプロバイダ（OpenAI等）を選択可能にし、`SimpleEmbeddingFunction` はフォールバック化
- [x] Chroma クライアントの永続化/サーバモード接続を検証（URL/パスのハンドリング、接続失敗時のフォールバック継続）
- [x] インデクス投入フロー整備（`src/backend/indexing.py` 拡充：重複除去、件数ログ、失敗時の再試行）
- [x] 設定項目の整理（`.env.example` 追加、必要な API キー/URL/レート上限を README に明記）
- [x] 単体テスト：プロバイダ差し替え時の挙動（LLM無し/鍵無し/タイムアウト/フォールバック）
- [x] ドキュメント：起動・シード手順（Docker Compose/ローカル）と運用パラメータを README に追記（`LLM_MODEL` を含む）

### PR2. バックエンド：フロー実用化（WordPack / ReadingAssist / Feedback）
- 現状の課題: 各フローはダミー中心で実用の最小品質に未達、例外/遅延時のフォールバックと確度制御が不足
- [x] WordPackFlow: LLM プロンプトで語義/例文/要点を整形、RAG `citations` と連動、`regenerate_scope` 反映
- [x] ReadingAssistFlow: 文分割の強化、用語抽出/パラフレーズを LLM で補強（RAG 併用）、確度ヒューリスティクス
- [x] FeedbackFlow: 語法/文法の指摘・書換案・ミニ演習を LLM 生成に置換、LLM無効時は安全フォールバック
- [x] 例外/遅延対策：フロー別タイムアウト、部分的フォールバック、トークン/遅延メトリクスの記録
- [x] 単体テスト：正常/異常（LLM無効、RAG無効、タイムアウト）で安定したスキーマ出力を確認

### PR3. API/フロント連携とUX仕上げ（SRSメタ、進捗連動、アクセシビリティ）
- 現状の課題: `WordPackPanel` の SRSメタが「未登録」表示のまま、カード状態の取得APIが未整備
- [x] 新API `GET /api/review/card_by_lemma?lemma=` を追加（存在しなければ作成オプション/読み取り専用の選択）
- [x] レスポンス：`{ repetitions, interval_days, due_at }` を返却し、`id = "w:<lemma>"` と整合
- [x] フロント：`WordPackPanel` の SRS メタ枠をAPI連携に更新、採点後の進捗/最近/人気の自動更新
- [x] UI/UX：キーボードショートカットのヘルプ表示、フォーカス遷移、トースト/ローディングの改善、引用/確度の表現強化
- [x] E2E：生成→採点→統計反映の一連動作、Asssit/Sentence の基本動作
- [x] UserManual：画面構成/ショートカット/進捗表示/新API連携を追記

### PR4. 運用・監視・安定化（レート制限/ログ/耐障害性/負荷）
- 現状の課題: 例外監視/レート制限/負荷耐性の運用準備が不足、ログは最小
- [x] API レート制限（IP/ユーザ単位の簡易トークンバケット）と 429 応答
- [x] 構造化ログ整備（リクエストID/遅延/LLM & RAG 呼び出し統計、WARN/ERRORの要約）
- [x] 例外監視（Sentry 等）導入フック（環境変数で有効化）
- [x] 負荷/回帰テスト更新（`tests/test_load_and_regression.py`）：RAG有効/無効の両モードで SLA 目安
- [x] Docker/Compose：ヘルスチェック/リソース上限/再起動ポリシー見直し

### PR5. ドキュメント/スキーマ/移行（README・UserManual・OpenAPI・SRS）
- 現状の課題: 新API/運用手順の記述不足、OpenAPI 例の未反映箇所あり
- [ ] README 更新：環境変数、起動/シード、RAG/LLM オプション、トラブルシュート
- [ ] UserManual 更新：学習フロー、採点、進捗の見える化、引用と確度の読み方
- [ ] OpenAPI 更新：`grade_by_lemma`/`card_by_lemma` 例・スキーマの追記、エラーコード整備
- [ ] SRS の既存データ移行注意点（DBパス/権限/バックアップ）を記載
- [ ] 回帰/ユニット/E2E テストの整合更新（新API/UX変更分）

---
補足:
- 本ロードマップは、暫定実装（ダミー/フォールバック中心）から「鍵設定すればそのまま運用投入可能」な状態までを 5PR に統合しています。
- 変更に伴う README / UserManual / 各テストの更新は各PR内に必ず含めます（破壊的変更は移行手順を明記）。

