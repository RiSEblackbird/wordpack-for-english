結論：**React（TS）は“単一ページ・最少状態・素のHTMLセマンティクス”方針で、UIは4パネル（カード、自作文、段落注釈、設定）に限定します。外部UIライブラリ・ルーター不使用、fetchのみでAPI連携、CSSは最小限。以下に既存2仕様＋React仕様をすべてMarkdownコードブロックで提示します。**

```markdown
# 英単語トレーナー（LLM×RAG×LangGraph）
## 目的・意義・使い方（あなた＝ターゲット／技術・科学英文＆発音対応）

## 0. 北極星（Purpose）
- 技術・科学の英文を**速く正確に読む**／語の**使い分け・共起・語域**と**発音（IPA・強勢・連結）**まで理解・再現できるようにする。
- 変更採否は次の5基準の3/5以上で決定：①20秒カード ②自作文促進 ③学習定着支援 ④不確実性の可視化 ⑤発音理解の支援。

## 1. 到達目標（Outcomes）
- 段落レベルの主述・修飾・論理関係を把握できる。
- ターゲット語の使い分け・学術コロケ・発音を説明できる。
- 1日1分×5カード（週4日以上）を回せる。

## 2. 提供価値
- **技術文脈最適化**（学術コロケ／構文注釈）＋**発音可視化**（IPA/強勢/連結）。
- **短時間反射**（短文例・空所補充・パラフレーズ）で理解→使用→反射を最短化。

## 3. コア機能（ユーザー視点）
- **周辺知識パック**：使い分け≤3、一般/学術コロケ、近義語“違いだけ”、CEFR例＋技術例、語源、発音（IPA/強勢/連結）、要点50–80字。
- **自作文フィードバック**：何が/なぜ/どう直す（各1行）＋修正案（自然/フォーマル/学術）＋空所1問。
- **段落注釈**：主述・修飾・結束語、語注（和訳・IPA）、重要文の言い換え。
- **セルフチェック**：クローズ/パラフレーズ、5枚/日。

## 4. シナリオ
- Abstract読解 → 注釈 → 未知語カード化 → 自文パラフレーズ → 発音確認。
- 技術ブログ頻出語（fine-tune/inference/converge/benchmark）で学術コロケと強勢確認。

## 5. 使い方ルール
- カードは**20秒以内**、自作文は**1–2分**、復習は**1分/日**。
- 発音は**IPA音読→強勢→連結**の順で10秒以内に確認。

## 6. 完成像（DoD）
- 1画面で意味・用法・発音が完結（スクロール不要／20秒）。
- 段落注釈は1クリック、カード≤1.5s／注釈≤5sで応答。
- “不確実”明示、RAG根拠提示。
```

```markdown
# 英単語トレーナー 技術仕様書（バックエンド／LLM／RAG／発音）

## 0. ランタイム・主要依存
- Python 3.13+ / FastAPI / LangChain / LangGraph / ChromaDB / SQLAlchemy / pydantic-settings / structlog
- LLM・埋め込みはENV切替（OpenAI/Azure/Anthropic 等）
- 発音：cmudict or g2p-en（ARPABET）→ IPA変換テーブル（内部実装）

## 1. API一覧
- `POST /api/word/pack`（周辺知識＋発音必須）
- `POST /api/sentence/check`（自作文フィードバック：技術寄せ）
- `POST /api/text/assist`（段落注釈：主述・修飾・語注・IPA・パラフレーズ）
- `POST /api/word`（任意登録）
- `GET /healthz`

## 2. スキーマ（要点）
**WordPack（抜粋／必須）**
- `lemma: string`
- `senses: [{id, gloss_ja, patterns[], register}]` （≤3）
- `collocations: {general:{}, academic:{}}`
- `contrast: [{with, diff_ja}]`（≤3）
- `examples: {A1[], B1[], C1[], tech[]}`
- `etymology: {note, confidence}`
- `pronunciation: {ipa_GA, ipa_RP?, syllables, stress_index, linking_notes[]}`
- `study_card: string (50–80 chars)`

**TextAssist Response（抜粋）**
- `sentences: [{raw, syntax:{subject,predicate,mods[]}, terms:[{lemma,gloss_ja,ipa,collocation?}], paraphrase}]`
- `summary: string`
- `citations: [{source, ids[]}]`

## 3. RAG
- コレクション：`word_snippets`（一般）／`domain_terms`（学術）
- `k=6`検索、根拠IDを`citations`に添付、ハルシ時は`confidence:"low"`＋最小カード。

## 4. LangGraph
- **WordPackFlow**：`Normalize → Retrieve(RAG) → Disambiguate → [Collocation|Contrast|Register|Etymology|Pronunciation] → Examples → Summarize → Persist`
- **FeedbackFlow**：`Collect → Diagnose → Suggest → MiniExercise → Log`
- **ReadingAssistFlow**：`Segment → ChunkParse → TermDetect(RAG) → InlineGloss+Pron → Paraphrase → Cache`

## 5. 非機能
- p95：カード≤1.5s、注釈≤5s。JSONログ（structlog）／基本メトリクス（latency, tokens）。
- セキュリティ：.env、CORS限定、PII保存しない、RAG素材ライセンス明記。
```

````markdown
# フロントエンド画面仕様（React.js + TypeScript）
**方針**：**最小コード量／素のHTMLセマンティクス／単一ページ／状態は局所useState**。  
- **不使用**：ルーター、状態管理ライブラリ、UIフレームワーク、アイコン、アニメーション。  
- **通信**：`fetch`のみ、`AbortController`でキャンセル。  
- **スタイル**：ブラウザデフォルト＋最小限の内蔵CSS（表示崩れ回避のみ）。

---

## 0. 画面構成（単一ページ／4パネル）
- **ヘッダー**：アプリ名、タブ（「カード」「自作文」「段落注釈」「設定」）
- **メイン**：選択タブのパネルのみ表示（条件レンダリング）
- **フッター**：ステータス（リクエスト中／エラー有り／APIベースURL）

**タブ**（切替は`useState<'card'|'sentence'|'assist'|'settings'>`）
1. **カード**：周辺知識パック表示＋保存済み一覧
2. **自作文**：文入力→診断結果表示
3. **段落注釈**：段落入力→注釈結果表示
4. **設定**：APIベースURL、モデル名、発音表示のON/OFF（UIだけ）

---

## 1. 共通UI要件
- **セマンティクス**：`<header> <nav> <main> <section> <article> <footer>`を使用。
- **見出し構造**：ページ`h1`、パネル`h2`、カード内セクション`h3`。
- **キーボード**：`Alt+1..4`でタブ切替、`/`で主要入力へフォーカス。
- **読み上げ**：結果領域は`role="status"`、エラーは`role="alert"`。
- **ローディング**：`aria-busy="true"`とテキスト（「処理中…」）。

---

## 2. パネル別仕様

### 2.1 カードパネル（「周辺知識」＋「保存済み一覧」）
**レイアウト（縦一列）**
- 入力行：`lemma`（テキスト）＋`pos`（任意）＋「取得」ボタン  
- 結果：**周辺知識カード**（1枚表示）

**周辺知識カード UI（順序厳守）**
1. 見出し行：`lemma`、発音バッジ（IPA GA / RP / 強勢・音節）
2. 使い分け（最大3・1行×各）
3. コロケーション  
   - 一般（V+O/Adj+N/Prep+N）  
   - 学術（同上、無ければ非表示）
4. 近義語“違いだけ”（最大3）
5. 例文（CEFR A1/B1/C1 各1–2、**技術例1–2**）
6. 語源（confidence表示）
7. 学習カード要点（50–80字）
8. 操作：**再生成**（selectで「全体／例文のみ／コロケのみ」）／**メモ保存**（単一テキスト）

**API連携**
- 取得：`POST /api/word/pack`（入力：`{lemma,pos?}`）
- 再生成：同API、再実行（AbortControllerで前回キャンセル）
- 保存済み一覧：`GET /api/word/packs` → 各アイテムを表示
- 削除・再生成：`DELETE /api/word/packs/{id}` / `POST /api/word/packs/{id}/regenerate`

**表示ルール**
- フィールド欠落は**明示**（例：「学術コロケ：該当なし」）。
- `confidence:"low"`が含まれる項目は末尾に「（不確実）」バッジ。

---

### 2.2 自作文パネル
**入力**：`textarea`（文）／`target`（任意テキスト）／「診断」ボタン  
**結果**（縦並び）：
- **Issues**（`what/why/fix` 各1行、箇条書き）
- **Revisions**（自然／フォーマル／必要時：非目標語案）
- **Mini Exercise**（空所1問：`q`と`a`の表示は折りたたみ`<details>`）

**API**：`POST /api/sentence/check`  
**UX**：診断中は入力をdisabled、結果領域`role="status"`。

---

### 2.3 段落注釈パネル
**入力**：`textarea`（段落）、`domain_hint`（select：ml/biology/physics/software/general）、「注釈」ボタン  
**結果**：
- 文ごと`<article>`  
  - 行1：生文  
  - 行2：主述・修飾（`Subject:` / `Predicate:` / `Mods:`）  
  - 行3：語注テーブル（`term | gloss_ja | IPA | note`）  
  - 行4：パラフレーズ（平文1行）
- サマリ（最後に1段落）

**API**：`POST /api/text/assist`  
**アクセシビリティ**：語注テーブルに`<table>`（見出し`<th>`付き）。

---

### 2.4 設定パネル
- 入力群：APIベースURL、モデル名（表示のみ）、**発音表示ON/OFF**（トグル）
- 注意：設定は**メモリのみ**（localStorage等はMVPで使わない）

---

## 3. 状態管理（ミニマム）
- すべて**ローカルstate**（各パネル内の`useState`）  
- 共有が必要なもの（APIベースURL／発音ON/OFF）は**親コンポーネントのstate**で保持、props降し。  
- 再試行中は**キャンセル**（AbortController）して重複リクエスト回避。

---

## 4. エラーハンドリング
- ネットワーク／422／500は**パネル内上部**に赤テキスト（`role="alert"`）。  
- LLM/RAG由来で項目が空のときは**明示**（例：「近義語：取得不可」）。  
- タイムアウトは10秒（UI上は「再試行」リンクのみ）。

---

## 5. UI文言（固定・日本語）
- 主要ラベル（例）：  
  - 取得／再生成／診断／注釈／採点／正解／部分正解／不正解  
  - 学術コロケ／近義語の違い／不確実／処理中…

---

## 6. モックデータ例（画面バインド形）
**カード結果（抜粋）**
```json
{
  "lemma": "converge",
  "pronunciation": {"ipa_GA": "/kənˈvɝːdʒ/", "syllables": 2, "stress_index": 1},
  "senses": [{"id":"v1","gloss_ja":"収束する"}],
  "collocations": {
    "general": {"verb_object":[], "adj_noun":[], "prep_noun":["converge on"]},
    "academic": {"verb_object":["converge on a solution"], "adj_noun":["asymptotic convergence"], "prep_noun":[]}
  },
  "contrast":[{"with":"conflate","diff_ja":"収束vs混同"}],
  "examples":{"A1":["Lines converge at a point."],"B1":["The algorithm converges quickly."],"tech":["The sequence converges almost surely."]},
  "etymology":{"note":"ラテン語由来","confidence":"medium"},
  "study_card":"学術文脈で“収束”の意味と用例に集中。"
}
````

**段落注釈（抜粋）**

```json
{
  "sentences":[
    {
      "raw":"Our algorithm converges under mild assumptions.",
      "syntax":{"subject":"Our algorithm","predicate":"converges","mods":["under mild assumptions"]},
      "terms":[{"lemma":"converge","gloss_ja":"収束する","ipa":"/kənˈvɝːdʒ/"}],
      "paraphrase":"前提が緩い条件でも収束する。"
    }
  ],
  "summary":"緩い条件下でアルゴリズムが収束することを主張。"
}
```

---

## 7. 最小スタイル仕様（任意）

* フォント：システムUI（既定）。
* 余白：各セクション上下`margin-block: .5rem`。
* テーブル：`border-collapse: collapse; border: 1px solid #ddd; padding: .25rem;`（見やすさ確保のみ）。
* レスポンシブ：600px以上でカード内セクションを2カラム化（任意／MVPでは単一カラムでも可）。

---

## 8. 受け入れ基準（UI）

* 各パネルが**単体で完結**して動作（他依存なし）。
* 主要操作が**キーボードのみ**で完遂（入力→送信→結果確認）。
* 結果表示に**不確実バッジ**と**根拠空欄時の明示**がある。
* タブ切替・APIキャンセル・エラー表示が正しく動作。

