# MDCルール作成マニュアル（内容品質特化）

目的：AIが一貫して安全に正解へ近づくよう、**短く・明確・再利用可能**なルールを書き、対象範囲だけに効かせる。

---

## 1) 原則（最重要）
- **短く**：一文件あたり目安500行未満。重い内容は分割。
- **用途単位で分割**：ユースケース/層/技術ごとに別ルールへ。
- **行動指示を具体化**：曖昧語（「適宜」「なるべく」）は使わない。
- **根拠を添える**：最低1つの@参照または最小コード例を併記。
- **誤用防止**：適用条件を明記（USE WHEN / DO NOT USE）。
- **再利用**：同じ指示を見かけたらルール化し重複を排除。

---

## 2) ファイル命名とスコープ設計
- 命名：`{領域}-{目的}.mdc`（例 `frontend-components.mdc`）。
- 粒度：**編集が衝突しない最小単位**まで割る（API検証, UI構造, Migrations 等）。
- スコープ優先順位：まず **Auto Attached（globs）** で最小範囲へ。常時必要な基礎は **Always**。誤爆が怖い場合は **Manual**。探索的支援は **Agent Requested**。
- ネスト：対象フォルダ直下に `.cursor/rules` を置き、**その領域の規約だけ**を定義。

---

## 3) ルール骨子（テンプレート）

```mdc
---
description: >
  USE WHEN: {対象と条件を一文で。例: "components/ 配下のReactコンポーネントを新規作成/改修するとき"}
  GOAL: {期待成果。例: "アクセシビリティと型安全を担保した実装"}
  OUTPUT: {成果物形式。例: "完成コードとテスト、根拠の@参照"}
globs:
  - "src/components/**/*.tsx"
alwaysApply: false
---

## Constraints
- 型: TypeScript必須。any禁止。Propsは明示型。
- アクセシビリティ: 見出しは階層順、フォームは関連ラベル必須。
- スタイル: Tailwind優先。ユーティリティは@styles/tokens.tsを参照。

## Procedure
1. 既存の類似@component-template.tsxを参照し、Props設計→実装→テストの順。
2. 破壊的変更は`CHANGELOG.md`に追記。関連Storyを更新。
3. 変更後、型チェックと単体テストを必ず緑にする。

## Patterns
- コンポーネント構造: Props定義→本体→スタイルの順。
- エラーハンドリング: ユーザ表示文言は@i18n.tsから取得。

## Examples
// Good: 完成例（最小）
"""tsx
export interface ButtonProps { label: string; onClick: () => void }
export function Button(p: ButtonProps) { return <button aria-label={p.label} onClick={p.onClick}>{p.label}</button> }
"""

// Bad: 曖昧・未完成・既存規約無視

* 「必要なら型をつける」/ 「とりあえず仮実装」

```

---

## 4) 記述スタイル

* 命令形・検査可能な表現：「〜を**行う**」「〜を**禁止**」。
* **成功条件**を明文化：生成物に含めるべき項目のチェックリストを列挙。
* **反例**を併記：よくある誤りを「Bad」として短く示す。
* **最小例**：10〜20行の完成コードで意図を固定。
* **@参照**：仕様源（スキーマ、デザインシステム、CLIヘルプ等）を`@file`で指す。

---

## 5) スコープ（globs）設計の実務指針

* 最初は**狭く始める**（例 `"src/api/**/*.ts"`）。誤爆時は更に細分化。
* ルールの**衝突は分割で解決**。排他条件は別ファイルに切る。
* プロダクト横断の基底規約は `base-*.mdc` として Always で定義し、各領域ルール内で**再掲しない**。

---

## 6) 品質ゲート（ルール内に書く項目）

* **静的検査**：型チェック/リンタ/フォーマッタが通ること。
* **テスト**：最低1つの正例・1つの負例を含む。
* **変更理由**：破壊的変更時は「判断基準」を1行で残す。
* **トレーサビリティ**：関連Issue/ADR/設計書の@参照。

---

## 7) よくある失敗と対処

* 失敗：長文化して汎用規約化 → 対処：**単機能に分割**し、重複は削除。
* 失敗：曖昧語 → 対処：**検査可能な述語**へ書き換え（例「100%型安全」等）。
* 失敗：例が未完成 → 対処：**コンパイル可能な最小完成例**に置換。
* 失敗：過剰スコープ → 対処：globsを**対象フォルダ限定**に。

---

## 8) 最小セット（推奨ファイル群）

* `base-quality-gates.mdc`：共通の検査条件（型/テスト/ドキュメント）。
* `api-validation.mdc`：API層のバリデーション規約。
* `ui-components.mdc`：UI構造とa11y規約。
* `migrations.mdc`：DBマイグレーション手順とロールバック条件。
* `docs-authoring.mdc`：生成ドキュメントの体裁と出力粒度。

---

## 9) ルール更新の作法

* 目的・影響範囲を冒頭に追記（何が/なぜ変わるか）。
* 互換性に配慮：既存ルールを壊す変更は**新ファイル**として導入。
* 大規模改訂は ADR へのリンクを追加し、古いルールに廃止予定を明記。

---

## 10) 出荷前チェックリスト

* [ ] スコープが狭い（対象外に影響しない）
* [ ] 成功条件と反例がある
* [ ] 最小完成コード例がある
* [ ] @参照が解決可能（存在するファイル/仕様）
* [ ] 他ルールと矛盾しない（重複指示なし）
