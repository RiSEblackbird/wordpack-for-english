---
description: "全プロジェクト共通のテスト最小規約（常時適用）"
globs: []
alwaysApply: true
---

# 共通ポリシー
- 階層：単体(多) ＞ 結合(中) ＞ E2E(少)。E2Eは重要動線のみ。
- スタイル：AAA/Given-When-Then。1テスト=1観点（分岐はパラメタライズ）。
- 決定性：時刻/乱数/ネットワークを固定（フェイクタイマ/シード/HTTPモック等）。
- 分離：並列実行での干渉禁止（一時ファイル/ポート/DB名前空間をテスト単位で分離）。
- カバレッジ目安：行・ステートメント≥80%、分岐≥70%（E2E除外）。閾値はCIでゲート。
- 失敗時の可観測性：期待値/HTTPコード/UIテキスト/例外型を具体化。
- 置き場所：対象コード近傍（`__tests__`や`*.test.*`）。E2Eは専用ディレクトリ。
- Flaky撲滅：一時スキップ放置禁止。待機/リトライは明示し、原因（非同期/競合）を修正。
- 最低限の非機能：権限/未認証遮断/入力サニタイズ、表示のアクセシビリティ、簡易性能しきい値を確認。
